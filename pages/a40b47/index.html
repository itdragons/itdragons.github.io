<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>docker-compose | itdragons</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3129839_xft6cqs5gc.css">
    <noscript><meta http-equiv="refresh" content="0; url=https://www.youngkbt.cn/noscript/"><style>.theme-vdoing-content { display:none }</noscript>
    <meta name="description" content="">
    <meta name="keywords" content="itdragons,个人技术博客,后端,后端开发,技术文档,学习">
    <meta name="baidu-site-verification" content="code-gl6pCjAEyB">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.a350ef4f.css" as="style"><link rel="preload" href="/assets/js/app.8cc1108e.js" as="script"><link rel="preload" href="/assets/js/2.240784d8.js" as="script"><link rel="preload" href="/assets/js/44.4ce36bab.js" as="script"><link rel="prefetch" href="/assets/js/10.f70e0eb0.js"><link rel="prefetch" href="/assets/js/11.74af464f.js"><link rel="prefetch" href="/assets/js/12.2ea465fb.js"><link rel="prefetch" href="/assets/js/13.93583a72.js"><link rel="prefetch" href="/assets/js/14.a80459e1.js"><link rel="prefetch" href="/assets/js/15.c1bd918f.js"><link rel="prefetch" href="/assets/js/16.a8fe53f1.js"><link rel="prefetch" href="/assets/js/17.5108c5a4.js"><link rel="prefetch" href="/assets/js/18.7da893f6.js"><link rel="prefetch" href="/assets/js/19.5d1d72ee.js"><link rel="prefetch" href="/assets/js/20.ecf584dc.js"><link rel="prefetch" href="/assets/js/21.6ce979ac.js"><link rel="prefetch" href="/assets/js/22.c8f33fd0.js"><link rel="prefetch" href="/assets/js/23.ad0fc34d.js"><link rel="prefetch" href="/assets/js/24.455a5391.js"><link rel="prefetch" href="/assets/js/25.d2da38d5.js"><link rel="prefetch" href="/assets/js/26.683e9ac4.js"><link rel="prefetch" href="/assets/js/27.4cde2cc0.js"><link rel="prefetch" href="/assets/js/28.e93b9ace.js"><link rel="prefetch" href="/assets/js/29.80720232.js"><link rel="prefetch" href="/assets/js/3.c705f478.js"><link rel="prefetch" href="/assets/js/30.68c182df.js"><link rel="prefetch" href="/assets/js/31.29c3050c.js"><link rel="prefetch" href="/assets/js/32.58d4b59e.js"><link rel="prefetch" href="/assets/js/33.0981e3f7.js"><link rel="prefetch" href="/assets/js/34.b6b8c625.js"><link rel="prefetch" href="/assets/js/35.af54b9e9.js"><link rel="prefetch" href="/assets/js/36.2ad665b6.js"><link rel="prefetch" href="/assets/js/37.2276ff98.js"><link rel="prefetch" href="/assets/js/38.a3bc4b25.js"><link rel="prefetch" href="/assets/js/39.9b17ffd2.js"><link rel="prefetch" href="/assets/js/4.a4f30451.js"><link rel="prefetch" href="/assets/js/40.5e98ebaa.js"><link rel="prefetch" href="/assets/js/41.78ee02f9.js"><link rel="prefetch" href="/assets/js/42.ed84c5d2.js"><link rel="prefetch" href="/assets/js/43.64ce95e3.js"><link rel="prefetch" href="/assets/js/45.edf39a66.js"><link rel="prefetch" href="/assets/js/46.3cbf895c.js"><link rel="prefetch" href="/assets/js/47.a6b1913f.js"><link rel="prefetch" href="/assets/js/5.17ef2cd7.js"><link rel="prefetch" href="/assets/js/6.c0cb50a1.js"><link rel="prefetch" href="/assets/js/7.a4e86073.js"><link rel="prefetch" href="/assets/js/8.8bb6dbad.js"><link rel="prefetch" href="/assets/js/9.065f2bc3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a350ef4f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="itdragons" class="logo"> <span class="site-name can-hide">itdragons</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/db/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/mysql/" class="nav-link">Mysql</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Devops" class="dropdown-title"><a href="/ops/" class="link-title">Devops</a> <span class="title" style="display:none;">Devops</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>容器技术</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/docker/" class="nav-link">docker</a></li><li class="dropdown-subitem"><a href="/pages/d6373c/" class="nav-link">k8s</a></li></ul></li><li class="dropdown-item"><h4>操作系统</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/4b06d4/" class="nav-link">linux</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li></ul></div></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/itdragons/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/db/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/mysql/" class="nav-link">Mysql</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Devops" class="dropdown-title"><a href="/ops/" class="link-title">Devops</a> <span class="title" style="display:none;">Devops</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>容器技术</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/docker/" class="nav-link">docker</a></li><li class="dropdown-subitem"><a href="/pages/d6373c/" class="nav-link">k8s</a></li></ul></li><li class="dropdown-item"><h4>操作系统</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/4b06d4/" class="nav-link">linux</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li></ul></div></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/itdragons/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/pages/d9cf10/" class="sidebar-link">docker安装</a></li><li><a href="/pages/13e416/" class="sidebar-link">常用命令</a></li><li><a href="/pages/a40b47/" aria-current="page" class="active sidebar-link">docker-compose</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/a40b47/#redis" class="sidebar-link">redis</a></li><li class="sidebar-sub-header level2"><a href="/pages/a40b47/#nginx" class="sidebar-link">nginx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/a40b47/#日志切割" class="sidebar-link">日志切割</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/a40b47/#mysql" class="sidebar-link">mysql</a></li><li class="sidebar-sub-header level2"><a href="/pages/a40b47/#tomcat" class="sidebar-link">tomcat</a></li><li class="sidebar-sub-header level2"><a href="/pages/a40b47/#jenkins" class="sidebar-link">jenkins</a></li><li class="sidebar-sub-header level2"><a href="/pages/a40b47/#rabbitmq" class="sidebar-link">rabbitMQ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/a40b47/#安装延迟插件" class="sidebar-link">安装延迟插件</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/a40b47/#rocketmq" class="sidebar-link">rocketMQ</a></li><li class="sidebar-sub-header level2"><a href="/pages/a40b47/#elk" class="sidebar-link">ELK</a></li><li class="sidebar-sub-header level2"><a href="/pages/a40b47/#常见问题" class="sidebar-link">常见问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/a40b47/#容器日志占用空间过大" class="sidebar-link">容器日志占用空间过大</a></li></ul></li></ul></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E3%80%8Adocker%E3%80%8B" title="分类" data-v-06225672>《docker》</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/itdragons" target="_blank" title="作者" class="beLink" data-v-06225672>itdragons</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-11-06</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">docker-compose<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="docker-compose"><a href="#docker-compose" class="header-anchor">#</a> docker-compose</h1> <h2 id="redis"><a href="#redis" class="header-anchor">#</a> redis</h2> <p>docker-compose.yml</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3&quot;

services:
  redis:
    image: redis
    container_name: redis
    environment:
      - TZ=Asia/Shanghai   # Asia/Tokyo
    command: redis-server /usr/local/etc/redis/redis.conf
    ports:
      - 6379:6379
    volumes:
      - ./redis/data:/data
      - ./redis/redis.conf:/usr/local/etc/redis/redis.conf
    networks:
      - cloud-net          # 加入的网络
      
networks:
  cloud-net:
    driver: bridge   #以桥接模式创建自定义网络，否则会使用默认的网络
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>redis.conf</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>## 1.允许远程连接
# bind 127.0.0.1
protected-mode no
## 2.持久化
appendonly yes
## 3.密码 
requirepass 'yourpassword'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="nginx"><a href="#nginx" class="header-anchor">#</a> nginx</h2> <p>docker-compose.yml</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3.1'
services:
  nginx:
    image: nginx
    restart: always
    container_name: nginx
    environment:
      - TZ=Asia/Shanghai
    ports:
      - 80:80
      - 443:443
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./log:/var/log/nginx
      - ./html:/html
      - /etc/letsencrypt:/etc/letsencrypt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>nginx.conf</p> <p><a href="https://juejin.im/post/6844903912277835789" target="_blank" rel="noopener noreferrer">[转]Nginx-负载均衡配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>user  nginx;
#nginx 进程数，建议按照cpu 数目来指定，一般为它的倍数。
worker_processes  2;

error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;


events {
	#单个后台worker process进程的最大并发链接数  
    worker_connections  1024;
}


http {
	#设定mime类型,类型由mime.type文件定义
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    #设定日志格式
    log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
                      '$status $body_bytes_sent &quot;$http_referer&quot; '
                      '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';

    access_log  /var/log/nginx/access.log  main;

    #开启gzip压缩
    gzip  on;
    gzip_disable &quot;MSIE [1-6].&quot;;

    #设定请求缓冲
    client_header_buffer_size    128k;
    large_client_header_buffers  4 128k;
	
	#sendfile 指令指定 nginx 是否调用 sendfile 函数（zero copy 方式）来输出文件，
	#对于普通应用，必须设为 on,
    #如果用来进行下载等应用磁盘IO重负载应用，可设置为 off，
    #以平衡磁盘与网络I/O处理速度，降低系统的uptime.
    sendfile on;
	
	#用于设置客户端连接保持活动的超时时间，在超过这个时间之后服务器会关闭该链接。
    #keepalive_timeout  0;
    keepalive_timeout  120; 
	
	#允许客户端请求的最大单文件字节数
	client_max_body_size 50m;
	
	#服务器名字的hash表大小
	server_names_hash_bucket_size 128;
	#header中自定义变量时支持下划线
	underscores_in_headers on; 
	
	#down 表示当前的server暂时不参与负载
	#weight 加权轮询权重,默认为1。weight越大，负载的权重就越大。
	#backup 备用服务器, 当其他所有的非backup机器出现故障或者忙的时候，才会请求backup机器，因此这台机器的压力最轻。
	#max_fails 允许请求失败的次数默认为1。当超过最大次数时，返回proxy_next_upstream 模块定义的错误
	#fail_timeout max_fails次失败后，暂停的时间。
	#apiServer不能用下划线,否则访问不到
	upstream apiServer {
    server 172.17.0.1:18081 weight=10;
    server 172.17.0.1:28081 weight=10;
  }

  # http 转 https
  server{
		listen 80;
		server_name www.hnbmc.com music.emenu.vip;
		rewrite ^ https://$http_host$request_uri? permanent;
	}
		
	server{
		listen 80;
		server_name admin.hnbmc.com;
		location / {
			try_files $uri $uri/ @router;
			root /html/hnbmc-admin;
			index index.html index.htm;
		}
		location /api {
			rewrite ^/api/?(.*)$ /$1 break;
			include uwsgi_params;
			proxy_pass http://172.17.0.1:18080;
		}
		proxy_set_header   Host             $host;
		proxy_set_header   X-Real-IP        $remote_addr;						
		proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
	}
	
	server {
    listen 443;
		server_name api.hnbmc.com;
		ssl on;
		root html;
		index index.html index.htm;
		ssl_certificate   /cert/xxxx_api.hnbmc.com.pem;
		ssl_certificate_key  /cert/xxxxapi.hnbmc.com.key;
		ssl_session_timeout 5m;
		ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
		ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
		ssl_prefer_server_ciphers on;
		location / {
			root /html/wap;
			index index.html index.htm;
			try_files $uri $uri/ /index.html;
		}
		location /api {
			rewrite ^/+api/?(.*)$ /$1 break;
			include uwsgi_params;
			proxy_pass http://apiServer;
		}
		proxy_set_header   Host             $host;
		proxy_set_header   X-Real-IP        $remote_addr;						
		proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
	}

}


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br></div></div><p>README.md</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 重新加载配置文件
docker exec -it nginx-container service nginx reload
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="日志切割"><a href="#日志切割" class="header-anchor">#</a> 日志切割</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>vi /home/docker/nginx/cutlogs.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>将下面的内容粘贴到cutlogs.sh文件中，:wq保存</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#!/bin/bash

# 指定日志和切割后日志备份的目录
YEAR=$(date +%Y)
MONTH=$(date +%m)
DAY=$(date +%d)
YESTERDAY=$(date -d &quot;yesterday&quot; +%Y-%m-%d)
LOGS_PATH=/home/docker/nginx/log
LOGS_BAK_PATH=/home/docker/nginx/log

# 得到1级目录名
if [[ $(($DAY)) -eq 1 ]]
  then
    if [[ $(($MONTH)) -eq 1 ]]
      then
        LOGS_BAK_PATH=$LOGS_BAK_PATH/$((${YEAR}-1))-12
    else
      if [[ $(($MONTH)) -gt 10 ]]
        then
          LOGS_BAK_PATH=$LOGS_BAK_PATH/${YEAR}-$((${MONTH}-1))
      else
          LOGS_BAK_PATH=$LOGS_BAK_PATH/${YEAR}-0$((${MONTH}-1))
      fi
    fi
else
    LOGS_BAK_PATH=$LOGS_BAK_PATH/${YEAR}-${MONTH}
fi

# 创建目录
mkdir -p $LOGS_BAK_PATH/${YESTERDAY}

# 复制当前的日志文件到备份的目录
cp ${LOGS_PATH}/access.log ${LOGS_BAK_PATH}/${YESTERDAY}/access_${YESTERDAY}.log
cp ${LOGS_PATH}/error.log ${LOGS_BAK_PATH}/${YESTERDAY}/error_${YESTERDAY}.log

# 清空日志
&gt; ${LOGS_PATH}/access.log
&gt; ${LOGS_PATH}/admin_access.log
&gt; ${LOGS_PATH}/error.log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>给<code>cutlogs.sh</code>增加权限</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>chmod 777 /home/docker/nginx/cutlogs.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建定时任务</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>vi /etc/crontab
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>将下面的内容添加到crontab文件中，wq保存。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 每天0:00执行该脚本
0 0 * * * root bash /home/docker/nginx/cutlogs.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>重启crontab</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>systemctl restart crond
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="mysql"><a href="#mysql" class="header-anchor">#</a> mysql</h2> <p>docker-compose.yml</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3.1'
services:
  db:
    image: mysql
    container_name: mysql
    restart: always
    environment:
      TZ: Asia/Shanghai
      MYSQL_ROOT_HOST: '%'
      MYSQL_ROOT_PASSWORD: root123!@#
      MYSQL_DATABASE: itdragons
      MYSQL_USER: itdragons
      MYSQL_PASSWORD: 123!@#
    command:
      --default-authentication-plugin=mysql_native_password
      --character-set-server=utf8mb4
      --collation-server=utf8mb4_0900_ai_ci
      --explicit_defaults_for_timestamp=true
      --lower_case_table_names=1
    ports:
      - 3306:3306
    volumes:
      - ./db:/var/lib/mysql
      - ./conf/my.cnf:/etc/my.cnf
      - ./init:/docker-entrypoint-initdb.d/
      - ./sql_backup:/backup

  adminer:
    image: adminer
    container_name: adminer
    restart: always
    ports:
      - 9006:8080
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>./conf/my.cnf</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[mysqld]
user=mysql
default-storage-engine=INNODB
character-set-server=utf8mb4
# 导入文件限制
max_allowed_packet=1024M
# 8.0版本自适应参数【很重要的配置】
innodb_dedicated_server=on
[client]
default-character-set=utf8mb4
[mysql]
default-character-set=utf8mb4
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>./init/init.sql</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SET character_set_client = utf8;
SET character_set_results = utf8;
SET character_set_connection = utf8;
-- 创建数据库:emenu_n2
use mysql;
create database emenu_n2;
-- 创建用户: emenu_n2
CREATE USER 'emenu_n2'@'%' IDENTIFIED BY '123!@#';
-- 授予用户通过外网IP对数据库“emenu_n2”的全部权限
-- all 可以替换为 select,delete,update,create,drop
grant all on emenu_n2.* to 'emenu_n2'@'%';
-- 刷新权限
flush privileges;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="tomcat"><a href="#tomcat" class="header-anchor">#</a> tomcat</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>|-- docker-compose.yml
|-- env
|   |-- project.env  #toomcat容器环境变量
|-- tomcat   
    |-- log    #tomcat日志   
    `-- webapps #tomcat项目存放目录
        `-- tomcat_project  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3.1'
services:
    tomcat:
        image: tomcat:8.0.53-jre8
        container_name: tomcat
        restart: always
        env_file:
            - ./env/project.env
        environment:
            - TZ=Asia/Shanghai
        ports:
          - 8787:8080
        volumes:
          - ./tomcat/webapps:/usr/local/tomcat/webapps
          - ./tomcat/log:/log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>增加环境变量配置文件project.env（该配置为tomcat启动参数）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>JAVA_OPTS=&quot;-Dsupplements.host=supplements&quot;
CATALINA_OPTS=-server -Xms256M -Xmx1024M -XX:MaxNewSize=256m -XX:PermSize=64M -XX:MaxPermSize=256m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="jenkins"><a href="#jenkins" class="header-anchor">#</a> jenkins</h2> <p>docker-compose.yml</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3'
services:
  jenkins:
    restart: always
    image: jenkins/jenkins:lts
    container_name: jenkins
    privileged: true  #允许特权
    ports:
      - 9090:8080
      - 50000:50000
    volumes:
      - /home/docker/server/docker-compose.yml:/home/docker/server/docker-compose.yml
      - ./data/:/var/jenkins_home
      - ./maven/settings-hd-docker.xml:/var/jenkins_home/tools/hudson.tasks.Maven_MavenInstallation/maven/conf/settings.xml
      - /var/run/docker.sock:/var/run/docker.sock
      - /usr/bin/docker:/usr/bin/docker
      - /usr/local/bin/docker-compose:/usr/local/bin/docker-compose
      - /usr/lib/x86_64-linux-gnu/libltdl.so.7:/usr/lib/x86_64-linux-gnu/libltdl.so.7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>权限：</p> <p>chown -R 1000:1000 /var/run/docker.sock</p> <p>chmod a+rx /usr/local/bin/docker-compose</p> <h2 id="rabbitmq"><a href="#rabbitmq" class="header-anchor">#</a> rabbitMQ</h2> <p>docker-compose.yml</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3'
services:
  #服务名称
  rabbitmq:
    #容器名称
    container_name: rabbitmq
    #镜像名称
    image: rabbitmq:3.8.8-management
    #总是重启后启动
    restart: always
    #端口映射
    ports:
      - 5672:5672
      - 15672:15672
    #挂载
    volumes:
      - ./data/rabbitmq:/var/lib/rabbitmq
      - ./data/plugins/rabbitmq_delayed_message_exchange-3.8.0.ez:/plugins/rabbitmq_delayed_message_exchange-3.8.0.ez
    #环境变量
    environment:
      - RABBITMQ_DEFAULT_VHOST=my_vhost
      - RABBITMQ_DEFAULT_USER=admin
      - RABBITMQ_DEFAULT_PASS=admin123
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="安装延迟插件"><a href="#安装延迟插件" class="header-anchor">#</a> 安装延迟插件</h3> <blockquote><p>进入docker内部：</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker exec -it rabbitmq bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>开启插件</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>rabbitmq-plugins enable rabbitmq_delayed_message_exchange
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>查询安装的所有插件</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>rabbitmq-plugins list
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>重启RabbitMQ</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>  docker restart rabbitmq
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="rocketmq"><a href="#rocketmq" class="header-anchor">#</a> rocketMQ</h2> <p>docker-compose.yml</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3.5'
services:
  rmqnamesrv:
    image: rocketmqinc/rocketmq:4.4.0
    container_name: rmqnamesrv
    ports:
      - 9876:9876
    volumes:
      - ./data/namesrv/logs:/opt/logs
      - ./data/namesrv/store:/opt/store
    environment:
        TZ: Asia/Shanghai
        JAVA_OPT_EXT: &quot;-server -Xms256m -Xmx256m -Xmn128m&quot;
    command: sh mqnamesrv

  rmqbroker:
    image: rocketmqinc/rocketmq:4.4.0
    container_name: rmqbroker
    ports:
      - 10911:10911
      - 10909:10909
    volumes:
      - ./data/broker/logs:/opt/logs
      - ./data/broker/store:/opt/store
      - ./data/broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf
    environment:
        TZ: Asia/Shanghai
        NAMESRV_ADDR: &quot;rmqnamesrv:9876&quot;
        JAVA_OPT_EXT: &quot;-server -Xms512m -Xmx512m -Xmn256m&quot;
    command: sh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.conf

  rmqconsole:
    image: pangliang/rocketmq-console-ng
    container_name: rmqconsole
    ports:
      - 8180:8080
    environment:
        TZ: Asia/Shanghai
        JAVA_OPTS: &quot;-Drocketmq.namesrv.addr=rmqnamesrv:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>broker.conf</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#所属集群名字
brokerClusterName=DefaultCluster

#broker名字，注意此处不同的配置文件填写的不一样，如果在broker-a.properties使用:broker-a,
#在broker-b.properties使用:broker-b
brokerName=broker-a

#0 表示Master，&gt;0 表示Slave
brokerId=0

#nameServer地址，分号分割
#namesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876

#启动IP,如果 docker 报 com.alibaba.rocketmq.remoting.exception.RemotingConnectException: connect to &lt;192.168.0.120:10909&gt; failed
# 解决方式1 加上一句producer.setVipChannelEnabled(false);，解决方式2 brokerIP1 设置宿主机IP，不要使用docker 内部IP
#brokerIP1=192.168.0.120

#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数
defaultTopicQueueNums=4

#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭 ！！！这里仔细看是false，false，false
#原因下篇博客见~ 哈哈哈哈
autoCreateTopicEnable=true

#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭
autoCreateSubscriptionGroup=true

#Broker 对外服务的监听端口
listenPort=10911

#删除文件时间点，默认凌晨4点
deleteWhen=04

#文件保留时间，默认48小时
fileReservedTime=120

#commitLog每个文件的大小默认1G
mapedFileSizeCommitLog=1073741824

#ConsumeQueue每个文件默认存30W条，根据业务情况调整
mapedFileSizeConsumeQueue=300000

#destroyMapedFileIntervalForcibly=120000
#redeleteHangedFileInterval=120000
#检测物理文件磁盘空间
diskMaxUsedSpaceRatio=88
#限制的消息大小
maxMessageSize=65536

#flushCommitLogLeastPages=4
#flushConsumeQueueLeastPages=2
#flushCommitLogThoroughInterval=10000
#flushConsumeQueueThoroughInterval=60000

#Broker 的角色
#- ASYNC_MASTER 异步复制Master
#- SYNC_MASTER 同步双写Master
#- SLAVE
brokerRole=ASYNC_MASTER

#刷盘方式
#- ASYNC_FLUSH 异步刷盘
#- SYNC_FLUSH 同步刷盘
flushDiskType=ASYNC_FLUSH

#发消息线程池数量
#sendMessageThreadPoolNums=128
#拉消息线程池数量
#pullMessageThreadPoolNums=128

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><h2 id="elk"><a href="#elk" class="header-anchor">#</a> <a href="/《docker》/devOps/docker/elk.html">ELK</a></h2> <h2 id="常见问题"><a href="#常见问题" class="header-anchor">#</a> 常见问题</h2> <h3 id="容器日志占用空间过大"><a href="#容器日志占用空间过大" class="header-anchor">#</a> 容器日志占用空间过大</h3> <p>docker容器日志导致主机磁盘空间满了。docker logs -f container_name一大堆，很占用空间，不用的日志可以清理掉了。在linux上，容器日志一般存放在/var/lib/docker/containers/container_id/下面。</p> <p>vim /etc/docker/daemon.json</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  &quot;log-driver&quot;:&quot;json-file&quot;,
   &quot;log-opts&quot;: {
    &quot;max-size&quot;: &quot;100m&quot;
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>重启使配置生效</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>systemctl restart docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h1 id="k8s"><a href="#k8s" class="header-anchor">#</a> <a href="/《docker》/devOps/k8s/">k8s</a></h1> <h1 id="云效"><a href="#云效" class="header-anchor">#</a> 云效</h1></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/itdragons/blog/edit/main/docs/《docker》/03.docker-compose.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/11/06, 14:46:24</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/13e416/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">常用命令</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/13e416/" class="prev">常用命令</a></span> <!----></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/6f9ae1/"><div>
            常用问题
            <!----></div></a> <span class="date">12-27</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/1780d1/"><div>
            itdragons
            <span class="title-tag">
              *
            </span></div></a> <span class="date">11-06</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/4b06d4/"><div>
            linux常用命令
            <!----></div></a> <span class="date">11-06</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="7121867@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/itdragons" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2022
    <span>itdragons | <a href="https://github.com/itdragons" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.8cc1108e.js" defer></script><script src="/assets/js/2.240784d8.js" defer></script><script src="/assets/js/44.4ce36bab.js" defer></script>
  </body>
</html>
